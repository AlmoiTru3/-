#!/usr/bin/env bash

# Номер варианта
TASKID=22

# VAR_1: количество строк в файле
VAR_1=$(wc -l < dns-tunneling.log)

# Обработка DNS-запросов типа A
{
    # Извлекаем запросы типа A (код 1) и доменные имена
    grep $'\tA\t' dns-tunneling.log | 
    # Берем последнее поле (доменное имя) и приводим к нижнему регистру
    awk -F'\t' '{print tolower($NF)}' |
    # Сортируем для uniq
    sort |
    # Подсчитываем уникальные вхождения
    uniq -c |
    # Меняем порядок: сначала домен, потом количество
    awk '{print $2 "\t" $1}' |
    # Сортируем по убыванию количества, затем по возрастанию имени
    sort -k2,2nr -k1,1
} > results.txt

# VAR_2: количество строк в results.txt
VAR_2=$(wc -l < results.txt)

# Вывод для проверки
echo "TASKID: $TASKID"
echo "VAR_1: $VAR_1"
echo "VAR_2: $VAR_2"
